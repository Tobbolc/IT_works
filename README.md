# IT_works
爱特的作业
着重渲染了商品展示页（买家），商品详情页（买家），商品管理页（卖家），订单详情页（买家），订单处理页（卖家），卖家主页

有待优化：
*更能区分卖家与买家的 更清晰合理的命名
*实现同一商品无限制下单
*邮箱验证码登录（使用Ajax和.val（））
*ckeditor5的配置与使用
*无限制评论的具体原理和样式美化



感悟：
*卖家id与label和商品label三者对应使得很多查询数据的步骤大大简化
*多加注释，规范化程序

加深理解的概念：
.all（）等价于一个列表对象，在前端调用需要用for循环遍历；.first（）直接是一个queryset，可以直接调用字段

新学到的用法：
*前端for循环时对象为空可以用{% empty %}
*ajax的进阶用法
*const path = window.location.pathname；//获取当前url
const Id = path.split（'/'）[2] //假设url为/order/3/detail/
*Ajax对象url中含有前端获取的变量名（orderId）时要如下写：const url = '/order/${orderId}/deal'；
*window.location.href = path可以在alert后重定向

### 角色0：全局（未登录）
*包含一个index.html
*自写分页器组件，功能更齐全，支持跳转页功能（打包成组件）
*自写搜索功能（在URL上添加get请求的因素），仅支持部分关键字搜索
*商品前端展示出图片（配置{{MEDIA_URL}}），名称，单价（小数点后两位）
*商品选择库存为0时不可下单（售罄按钮），不选择自动下架（不知道对性能有何优化）。
*未展示出的有用户点击量，以此作为推荐算法的依据，按照倒序展示
*未登录点击下单会有响应提示
### 角色1：买家
#### 1：鉴权
登录界面使用图片验证码，未设置邮箱验证码登录
*登录使用Form
*注册输入用户名，密码，邮箱，手机号，使用ModelForm
*利用form.is_valid（）来验证数据有效性，未使用正则表达式
*（思路一较麻烦，未使用异步）将登录界面的用户名传递到忘记密码函数（通过post请求和session存储），点击忘记密码按钮后发送邮箱验证码，此处使用Django自带的django.core.mail的send_mail功能
*登录界面忘记密码和个人中心修改密码跳转到一个界面
*利用session存储标记已发送邮件的状态，避免重复发送
#### 2.下单
*商品详情页利用css和js美化
*将带有商品图片的整个卡片变为可点击状态
*购物车添加  获取url中的商品序号，利用Ajax发送到后端，筛选，改变cart_state，筛选符合条件的展示在前端页面
*不支持同一商品重复下单，为了方便处理
#### 3.评论
*买家在商品详情页可对商品进行评论
*在商品详情页给买家展示卖家和其他买家对于此商品的评论
*支持无限制评论（利用parent评论和外键来实现）
*对于用户名相同的，即自己的评论，可以删除
#### 4.订单
*在订单详情页只实时计算总额并显示（实现方式问的ai），最终将商品id和数量利用Ajax传回后端，在后端进行操作后创建订单
*订单状态分为未提交，处理中，已拒绝，已通过四种，其中商家处理中用户可取消订单
*被拒绝的订单会退款，用户自己取消的订单也会退款
*历史订单的展示在后端使用value_list获取一系列commodity的queryset
#### 5.搜索
*简单的利用数据库查询
*店铺详情页从商品详情页跳转
#### 6.商品推荐
*按照用户点击量倒序
#### 7个人中心
*简单地罗列各个要素，还没学会更好看更实际的排版
*修改密码利用旧密码查找数据，并更新新密码，着重注意md5的使用和form.clean_data的含义
*基本资料，包括用户名密码手机邮箱，利用自定义函数进行了隐私处理
*隐私处理的函数屏蔽了下拉菜单刷新
*头像上传利用form 的encrypte参数，并利用open函数遍历chunks保存，最后利用ContentFile创建文件对象（每次刷新都要读取）并save（存疑，内部如何工作，如何避免每次都读取）
#### 8.钱包
*个人余额，充值，利用Ajax传递参数，与修改个人资料类似（将str转化为floatfield）
### 角色2：卖家
#### 1.鉴权：
*注册登录登出修改密码忘记密码思路与买家类似
*优化：邮箱验证码登录（未处理）
#### 2.店铺与商品：
*卖家的index主页即个人店铺主页，与买家的个人中心类似
*卖家设置分类，与不同种类商品一一对应，方便处理，关键在于store_id与label相同（投机取巧）
*发布新品利用Form表单，跟修改买家个人信息类似
*发布商品时只涉及名称，原价，现价和库存，商品标签与店铺标签对接，方便处理
*商品详情使用django-ckeditor富文本编辑器
*通过Ajax发送操作参数，传递带有orderId的url
#### 5.评论处理
*卖家的商品管理页只展示买家对于此商品的评论
*卖家只可以回复买家的评论
### 角色3：Admin管理员
*理解：提供一个可视化数据操作界面，类似于Navicate
#### 1.冻结
*给卖家和买家添加is_active（）字段，用于判断激活和冻结
*只有激活状态下买家才可以创建订单，卖家才可以上下架商品，处理订单，其余的操作如删除商品发布新品操作类似
#### 2.标签
*后台选择商品标签
#### 3.批量操作actions
*实现批量上架选中商品和批量下架选中商品的功能
#### 4.搜索过滤filter
*因为买家和卖家是分开的模型，所以不支持用户类型过滤
*支持商品类型，商品上架状态过滤，商品名称搜索
*支持订单创建时间和订单处理状态过滤，订单号 商品名 买家名称和卖家名称来搜索